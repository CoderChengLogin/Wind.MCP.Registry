<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.wind.mcp.registry.mapper.ProviderAppMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="cn.com.wind.mcp.registry.entity.ProviderApp">
        <id column="id" property="id"/>
        <result column="provider_id" property="providerId"/>
        <result column="app_name" property="appName"/>
        <result column="site_type" property="siteType"/>
        <result column="app_ip" property="appIp"/>
        <result column="app_port" property="appPort"/>
        <result column="load_factor" property="loadFactor"/>
        <result column="request_timeout" property="requestTimeout"/>
        <result column="max_fail_count" property="maxFailCount"/>
        <result column="is_enabled" property="isEnabled"/>
        <result column="app_description" property="appDescription"/>
        <result column="health_check_url" property="healthCheckUrl"/>
        <result column="health_check_interval" property="healthCheckInterval"/>
        <result column="status" property="status"/>
        <result column="create_by" property="createBy"/>
        <result column="create_time" property="createTime"/>
        <result column="update_by" property="updateBy"/>
        <result column="last_update_time" property="lastUpdateTime"/>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id
        , provider_id, app_name, site_type, app_ip, app_port, load_factor,
        request_timeout, max_fail_count, is_enabled, app_description,
        health_check_url, health_check_interval, status, create_by,
        create_time, update_by, last_update_time
    </sql>

    <!-- 根据提供者ID查询所有应用节点 -->
    <select id="selectByProviderId" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM provider_app
        WHERE provider_id = #{providerId}
        AND status != -1
        ORDER BY create_time DESC
    </select>

    <!-- 根据提供者ID和应用名称查询应用节点 -->
    <select id="selectByProviderIdAndAppName" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM provider_app
        WHERE provider_id = #{providerId}
        AND app_name = #{appName}
        AND status != -1
        ORDER BY create_time DESC
    </select>

    <!-- 查询已启用的应用节点 -->
    <select id="selectEnabledByProviderId" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM provider_app
        WHERE provider_id = #{providerId}
        AND is_enabled = 1
        AND status = 1
        ORDER BY create_time DESC
    </select>

</mapper>
