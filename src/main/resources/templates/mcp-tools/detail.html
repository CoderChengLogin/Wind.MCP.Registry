<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title th:text="${tool.toolName} + ' - MCP工具注册中心'">工具详情 - MCP工具注册中心</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Prism.js for code highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css" rel="stylesheet">
    <!-- 自定义CSS -->
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<!-- 导航栏 -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" th:href="@{/}">
            <i class="fas fa-tools me-2"></i>MCP工具注册中心
        </a>

        <button class="navbar-toggler" data-bs-target="#navbarNav" data-bs-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/}">
                        <i class="fas fa-home me-1"></i>首页
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" th:href="@{/mcp-tools}">
                        <i class="fas fa-cogs me-1"></i>MCP工具
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/origin-http-tools}">
                        <i class="fas fa-globe me-1"></i>HTTP工具
                    </a>
                </li>
            </ul>

            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/about}">
                        <i class="fas fa-info-circle me-1"></i>关于
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- 主要内容区域 -->
<main class="container mt-4">
    <!-- 面包屑导航 -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a th:href="@{/}">首页</a></li>
            <li class="breadcrumb-item"><a th:href="@{/mcp-tools}">MCP工具</a></li>
            <li class="breadcrumb-item active" th:text="${tool.toolName}">工具详情</li>
        </ol>
    </nav>

    <!-- 工具标题和操作 -->
    <div class="d-flex justify-content-between align-items-start mb-4">
        <div>
            <h1 class="mb-2">
                <i class="fas fa-cogs me-2"></i>
                <span th:text="${tool.toolName}">工具名称</span>
            </h1>
            <div class="mb-2">
                    <span class="badge me-2"
                          th:classappend="${tool.valid == '1' ? 'bg-success' : 'bg-secondary'}"
                          th:text="${tool.valid == '1' ? '有效' : '无效'}">状态</span>
                <span class="badge bg-info me-2" th:if="${tool.toolType}" th:text="${tool.toolType}">类型</span>
                <span class="badge bg-secondary" th:if="${tool.toolVersion}"
                      th:text="'v' + ${tool.toolVersion}">版本</span>
            </div>
        </div>

        <div class="btn-group" role="group">
            <a class="btn btn-outline-primary" th:href="@{/mcp-tools/edit/{id}(id=${tool.id})}">
                <i class="fas fa-edit me-1"></i>编辑
            </a>
            <a class="btn btn-outline-secondary" th:href="@{/mcp-tools}">
                <i class="fas fa-arrow-left me-1"></i>返回列表
            </a>
        </div>
    </div>

    <div class="row">
        <!-- 主要信息 -->
        <div class="col-md-8">
            <!-- MCP工具信息 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>MCP工具信息</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-3">工具名称:</dt>
                        <dd class="col-sm-9" th:text="${tool.toolName}">工具名称</dd>

                        <dt class="col-sm-3">工具描述:</dt>
                        <dd class="col-sm-9" th:text="${tool.toolDescription}">工具描述</dd>

                        <dt class="col-sm-3">显示名称:</dt>
                        <dd class="col-sm-9" th:text="${tool.nameDisplay}">显示名称</dd>

                        <dt class="col-sm-3">显示描述:</dt>
                        <dd class="col-sm-9" th:text="${tool.descriptionDisplay}">显示描述</dd>

                        <dt class="col-sm-3">工具类型:</dt>
                        <dd class="col-sm-9" th:text="${tool.toolType}">工具类型</dd>

                        <dt class="col-sm-3">转换类型:</dt>
                        <dd class="col-sm-9" th:text="${tool.convertType == '1' ? 'HTTP工具' : '其他'}">转换类型</dd>

                        <dt class="col-sm-3">流式输出:</dt>
                        <dd class="col-sm-9" th:text="${tool.streamOutput == '1' ? '是' : '否'}">流式输出</dd>

                        <dt class="col-sm-3">有效状态:</dt>
                        <dd class="col-sm-9">
                            <span class="badge" th:classappend="${tool.valid == '1' ? 'bg-success' : 'bg-secondary'}"
                                  th:text="${tool.valid == '1' ? '有效' : '无效'}">状态</span>
                        </dd>
                    </dl>
                </div>
            </div>

            <!-- 源HTTP工具信息 -->
            <div class="card mb-4" th:if="${httpTool != null}">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-globe me-2"></i>源HTTP工具信息</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-3">工具名称:</dt>
                        <dd class="col-sm-9" th:text="${httpTool.nameDisplay}">HTTP工具名称</dd>

                        <dt class="col-sm-3">描述:</dt>
                        <dd class="col-sm-9" th:text="${httpTool.descDisplay}">HTTP工具描述</dd>

                        <dt class="col-sm-3">请求URL:</dt>
                        <dd class="col-sm-9">
                            <code th:text="${httpTool.reqUrl}">http://example.com</code>
                        </dd>

                        <dt class="col-sm-3">请求方法:</dt>
                        <dd class="col-sm-9">
                            <span class="badge bg-info" th:text="${httpTool.reqMethod}">GET</span>
                        </dd>

                        <dt class="col-sm-3">请求头:</dt>
                        <dd class="col-sm-9">
                            <pre th:if="${httpTool != null and httpTool.reqHeaders != null and httpTool.reqHeaders.length() > 0}"
                                 th:text="${httpTool.reqHeaders}">请求头信息</pre>
                            <span class="text-muted"
                                  th:if="${httpTool == null or httpTool.reqHeaders == null or httpTool.reqHeaders.length() == 0}">无</span>
                        </dd>

                        <dt class="col-sm-3">输入参数:</dt>
                        <dd class="col-sm-9">
                            <pre th:if="${httpTool.inputSchema != null and !#strings.isEmpty(httpTool.inputSchema)}"
                                 th:text="${httpTool.inputSchema}">输入参数Schema</pre>
                            <span class="text-muted"
                                  th:if="${httpTool.inputSchema == null or httpTool.inputSchema.isEmpty()}">无</span>
                        </dd>
                    </dl>
                </div>
            </div>

            <!-- HTTP转换模板信息 -->
            <div class="card mb-4" th:if="${converter != null}">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-exchange-alt me-2"></i>HTTP转换模板信息</h5>
                </div>
                <div class="card-body">
                    <dl class="row">
                        <dt class="col-sm-3">模板URL:</dt>
                        <dd class="col-sm-9">
                            <code th:text="${converter.reqUrl}">模板URL</code>
                        </dd>

                        <dt class="col-sm-3">请求方法:</dt>
                        <dd class="col-sm-9">
                            <span class="badge bg-info" th:text="${converter.reqMethod}">方法</span>
                        </dd>

                        <dt class="col-sm-3">请求头模板:</dt>
                        <dd class="col-sm-9">
                            <pre th:if="${converter.reqHeaders != null and !#strings.isEmpty(converter.reqHeaders)}"
                                 th:text="${converter.reqHeaders}">请求头模板</pre>
                            <span class="text-muted"
                                  th:if="${converter.reqHeaders == null or converter.reqHeaders.isEmpty()}">无</span>
                        </dd>

                        <dt class="col-sm-3">请求体模板:</dt>
                        <dd class="col-sm-9">
                            <pre th:if="${converter.reqBody != null and !#strings.isEmpty(converter.reqBody)}"
                                 th:text="${converter.reqBody}">请求体模板</pre>
                            <span class="text-muted"
                                  th:if="${converter.reqBody == null or converter.reqBody.isEmpty()}">无</span>
                        </dd>
                    </dl>
                </div>
            </div>

            <!-- 缺失数据提示 -->
            <div class="alert alert-warning" th:if="${httpTool == null and converter == null}">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>提示:</strong> 该MCP工具缺少关联的源HTTP工具和转换模板信息。
            </div>
            <div class="alert alert-warning" th:if="${httpTool == null and converter != null}">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>提示:</strong> 该MCP工具缺少关联的源HTTP工具信息。
            </div>
            <div class="alert alert-warning" th:if="${httpTool != null and converter == null}">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>提示:</strong> 该MCP工具缺少关联的转换模板信息。
            </div>
        </div>

        <!-- 侧边栏信息 -->
        <div class="col-md-4">
            <!-- 基本信息 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-info me-2"></i>基本信息</h5>
                </div>
                <div class="card-body">
                    <dl class="row mb-0">
                        <dt class="col-sm-4">工具ID:</dt>
                        <dd class="col-sm-8" th:text="${tool.id}">1</dd>

                        <dt class="col-sm-4">工具编号:</dt>
                        <dd class="col-sm-8" th:text="${tool.toolNum}">工具编号</dd>

                        <dt class="col-sm-4">工具版本:</dt>
                        <dd class="col-sm-8" th:text="${tool.toolVersion}">版本号</dd>

                        <dt class="col-sm-4">创建时间:</dt>
                        <dd class="col-sm-8" th:text="${#temporals.format(tool.createTime, 'yyyy-MM-dd HH:mm:ss')}">
                            2024-01-01 12:00:00
                        </dd>

                        <dt class="col-sm-4" th:if="${tool.createBy}">创建者:</dt>
                        <dd class="col-sm-8" th:if="${tool.createBy}" th:text="${tool.createBy}">创建者</dd>

                        <dt class="col-sm-4" th:if="${tool.updateTime}">更新时间:</dt>
                        <dd class="col-sm-8" th:if="${tool.updateTime}"
                            th:text="${#temporals.format(tool.updateTime, 'yyyy-MM-dd HH:mm:ss')}">2024-01-01 12:00:00
                        </dd>

                        <dt class="col-sm-4" th:if="${tool.updateBy}">更新者:</dt>
                        <dd class="col-sm-8" th:if="${tool.updateBy}" th:text="${tool.updateBy}">更新者</dd>
                    </dl>
                </div>
            </div>

            <!-- JSON Schema信息 -->
            <div class="card mb-4" th:if="${tool.inputSchema != null or tool.outputSchema != null}">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-code me-2"></i>Schema信息</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3" th:if="${tool.inputSchema != null}">
                        <h6>输入Schema:</h6>
                        <pre class="bg-light p-2 rounded" style="max-height: 200px; overflow-y: auto;"
                             th:text="${tool.inputSchema}">输入Schema</pre>
                    </div>
                    <div th:if="${tool.outputSchema != null}">
                        <h6>输出Schema:</h6>
                        <pre class="bg-light p-2 rounded" style="max-height: 200px; overflow-y: auto;"
                             th:text="${tool.outputSchema}">输出Schema</pre>
                    </div>
                </div>
            </div>

            <!-- 操作按钮 -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0"><i class="fas fa-tools me-2"></i>操作</h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a class="btn btn-primary" th:href="@{/mcp-tools/edit/{id}(id=${tool.id})}">
                            <i class="fas fa-edit me-1"></i>编辑工具
                        </a>
                        <button class="btn btn-danger" onclick="confirmDelete([[${tool.id}]], '[[${tool.toolName}]]')"
                                type="button">
                            <i class="fas fa-trash me-1"></i>删除工具
                        </button>
                        <a class="btn btn-outline-secondary" th:href="@{/mcp-tools}">
                            <i class="fas fa-list me-1"></i>返回列表
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- 删除确认模态框 -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">确认删除</h5>
                <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
            </div>
            <div class="modal-body">
                <p>确定要删除工具 "<span id="deleteToolName"></span>" 吗？</p>
                <p class="text-danger">此操作不可撤销！</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">取消</button>
                <form id="deleteForm" method="post" style="display: inline;">
                    <button class="btn btn-danger" type="submit">确认删除</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Prism.js for code highlighting -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>

<script>
    function confirmDelete(toolId, toolName) {
        document.getElementById('deleteToolName').textContent = toolName;
        document.getElementById('deleteForm').action = '/mcp-tools/delete/' + toolId;
        new bootstrap.Modal(document.getElementById('deleteModal')).show();
    }

    function copyConfig() {
        const configElement = document.getElementById('toolConfig');
        const text = configElement.textContent;

        navigator.clipboard.writeText(text).then(function () {
            // 显示复制成功提示
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-check me-1"></i>已复制';
            button.classList.remove('btn-outline-secondary');
            button.classList.add('btn-success');

            setTimeout(function () {
                button.innerHTML = originalText;
                button.classList.remove('btn-success');
                button.classList.add('btn-outline-secondary');
            }, 2000);
        }).catch(function (err) {
            console.error('复制失败: ', err);
        });
    }
</script>
</body>
</html>